<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.30">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Endian</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-9884a2177d2957eae00b06e372949a78.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-6143deb5822414b99d6193ead6da13dd.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="fullcontent">

<div id="quarto-search-results"></div>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Endian</h1>
            <p class="subtitle lead">0x1.4</p>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<style>
  * {
    background-repeat: no-repeat;
    background-attachment: fixed;
  }
</style>
<section id="review-show" class="level1">
<h1>Review&nbsp;<a class="btn btn-primary" data-bs-toggle="collapse" href="#review" role="button" aria-expanded="false" aria-controls="review">Show</a></h1>
<div id="review" class="collapse multi-collapse">
<section id="goal-differentiate-different-integer-encodings." class="level3">
<h3 class="anchored" data-anchor-id="goal-differentiate-different-integer-encodings.">Goal: Differentiate different integer encodings.</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Review:</th>
<th>Newish:</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>- SHA</td>
<td>- stdint</td>
</tr>
<tr class="even">
<td>- Bits</td>
<td>- fileio</td>
</tr>
<tr class="odd">
<td>- Arrays</td>
<td>- htonll</td>
</tr>
<tr class="even">
<td>- Printb</td>
<td>- memset</td>
</tr>
</tbody>
</table>
<ul>
<li>There are no required exercises of this lab.</li>
<li>It is supplementary material to the SHAinC homework.</li>
<li><code>Option</code> and <code>htonll</code> are the major optional exercises that support SHAinC.
<ul>
<li>They are what I regard as likely to be the optimal solutions to problems I expect you to encounter.</li>
</ul></li>
<li>‘Memset’ might, or might not, help a lot (depending on how you think).</li>
<li><code>Arrays</code> will help you at high probability if you encounter a segmentation fault.</li>
</ul>
</section>
</div>
</section>
<section id="podman-show" class="level1">
<h1>Podman&nbsp;<a class="btn btn-primary" data-bs-toggle="collapse" href="#podman" role="button" aria-expanded="false" aria-controls="podman">Show</a></h1>
</section>
<div id="podman" class="collapse multi-collapse">
<section id="setup" class="level1">
<h1>Setup</h1>
<ul>
<li>For this lab, I used the following Containerfile
<ul>
<li>Same as the C89/99 lecture</li>
</ul></li>
</ul>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Containerfile</strong></pre>
</div>
<div class="sourceCode" id="cb1" data-filename="Containerfile"><pre class="sourceCode email code-with-copy"><code class="sourceCode email"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>FROM ubuntu</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>RUN apt update &amp;&amp; apt install gcc vim -y</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>I built via the following:</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="sourceCode email code-with-copy"><code class="sourceCode email"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>podman build -t c89_99 .</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>I conducted the full lab within a single container’s <code>vim</code> instance.</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="sourceCode email code-with-copy"><code class="sourceCode email"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>podman run -it printb vim endian.c</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>I conducted all work within this <code>vim</code> window and its <code>:term</code></li>
</ul>
</section>
</div>
<section id="stdint-show" class="level1">
<h1>stdint&nbsp;<a class="btn btn-primary" data-bs-toggle="collapse" href="#stdint" role="button" aria-expanded="false" aria-controls="stdint">Show</a></h1>
<div id="stdint" class="collapse multi-collapse">
<section id="stdint.h" class="level2">
<h2 class="anchored" data-anchor-id="stdint.h">stdint.h</h2>
<ul>
<li>Before doing anything else, we should get 32 bit words.</li>
<li>I use <code>stdint.h</code>.</li>
<li>Change last weeks homework to:
<ul>
<li>Add an <code>include</code> and</li>
<li>Remove <code>unsigned</code> by converting to</li>
<li><code>uint32_t</code></li>
</ul></li>
<li>Say I had this (incorrect) code:</li>
</ul>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>macros.c</strong></pre>
</div>
<div class="sourceCode" id="cb4" data-filename="macros.c"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define CHOICE</span><span class="op">(</span><span class="pp">e</span><span class="op">,</span><span class="pp">f</span><span class="op">,</span><span class="pp">g</span><span class="op">)</span><span class="pp"> </span><span class="op">((</span><span class="pp">e</span><span class="op">)?(</span><span class="pp">f</span><span class="op">):(</span><span class="pp">g</span><span class="op">))</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#define MEDIAN</span><span class="op">(</span><span class="pp">e</span><span class="op">,</span><span class="pp">f</span><span class="op">,</span><span class="pp">g</span><span class="op">)</span><span class="pp"> </span><span class="op">((!!(</span><span class="pp">e</span><span class="op">)</span><span class="pp"> </span><span class="op">+</span><span class="pp"> </span><span class="op">!!(</span><span class="pp">f</span><span class="op">)</span><span class="pp"> </span><span class="op">+</span><span class="pp"> </span><span class="op">!!(</span><span class="pp">g</span><span class="op">))</span><span class="pp"> </span><span class="op">&gt;</span><span class="pp"> </span><span class="dv">1</span><span class="op">)</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#define ROTATE</span><span class="op">(</span><span class="pp">a</span><span class="op">,</span><span class="pp">n</span><span class="op">)</span><span class="pp"> </span><span class="op">((</span><span class="pp">a</span><span class="op">)</span><span class="pp"> </span><span class="op">&gt;&gt;</span><span class="pp"> </span><span class="op">(</span><span class="pp">n</span><span class="op">))</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span> <span class="op">{</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> e <span class="op">=</span> <span class="bn">0xAA</span><span class="op">,</span> f <span class="op">=</span> <span class="bn">0x55</span><span class="op">,</span> g <span class="op">=</span> <span class="bn">0x66</span><span class="op">;</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    CHOICE<span class="op">(</span>e<span class="op">,</span>g<span class="op">,</span>g<span class="op">);</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    MEDIAN<span class="op">(</span>e<span class="op">,</span>f<span class="op">,</span>g<span class="op">);</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    ROTATE<span class="op">(</span>e<span class="op">,</span>f<span class="op">);</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Include <code>stdint</code> and update type names:</li>
</ul>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>macros.c</strong></pre>
</div>
<div class="sourceCode" id="cb5" data-filename="macros.c"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdint.h&gt;</span><span class="pp"> / * !!! NEW */</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#define CHOICE</span><span class="op">(</span><span class="pp">e</span><span class="op">,</span><span class="pp">f</span><span class="op">,</span><span class="pp">g</span><span class="op">)</span><span class="pp"> </span><span class="op">((</span><span class="pp">e</span><span class="op">)?(</span><span class="pp">f</span><span class="op">):(</span><span class="pp">g</span><span class="op">))</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#define MEDIAN</span><span class="op">(</span><span class="pp">e</span><span class="op">,</span><span class="pp">f</span><span class="op">,</span><span class="pp">g</span><span class="op">)</span><span class="pp"> </span><span class="op">((!!(</span><span class="pp">e</span><span class="op">)</span><span class="pp"> </span><span class="op">+</span><span class="pp"> </span><span class="op">!!(</span><span class="pp">f</span><span class="op">)</span><span class="pp"> </span><span class="op">+</span><span class="pp"> </span><span class="op">!!(</span><span class="pp">g</span><span class="op">))</span><span class="pp"> </span><span class="op">&gt;</span><span class="pp"> </span><span class="dv">1</span><span class="op">)</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#define ROTATE</span><span class="op">(</span><span class="pp">a</span><span class="op">,</span><span class="pp">n</span><span class="op">)</span><span class="pp"> </span><span class="op">((</span><span class="pp">a</span><span class="op">)</span><span class="pp"> </span><span class="op">&gt;&gt;</span><span class="pp"> </span><span class="op">(</span><span class="pp">n</span><span class="op">))</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span> <span class="op">{</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint32_t</span> e <span class="op">=</span> <span class="bn">0xAA</span><span class="op">,</span> f <span class="op">=</span> <span class="bn">0x55</span><span class="op">,</span> g <span class="op">=</span> <span class="bn">0x66</span><span class="op">;</span> <span class="co">/* !!! NEW */</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    CHOICE<span class="op">(</span>e<span class="op">,</span>g<span class="op">,</span>g<span class="op">);</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    MEDIAN<span class="op">(</span>e<span class="op">,</span>f<span class="op">,</span>g<span class="op">);</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    ROTATE<span class="op">(</span>e<span class="op">,</span>f<span class="op">);</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>An astute student may note that one obvious way to make such change is to:</p>
<ol type="1">
<li>Open Python</li>
<li>Read in <code>macros.c</code> via <code>open</code> into a string variable.</li>
<li>Close the file descriptor to <code>macros.c</code></li>
<li>Perform a replace from <code>unsigned to</code>uint32_t`.</li>
<li>Write the file to <code>macros.c</code></li>
</ol>
<p>While in this case we are performing a single string substitutions, and Python is hardly the best choice for so simple a transform, it is always appropriate to use scripts, rather than manual methods, write and edit code.</p>
</div>
</div>
<ul>
<li>You also need to use exactly one 64 bit numerical value, <em>l</em>
<ul>
<li>The message length in bits.</li>
<li>We recall the SHA-2 standard caps messages at length <code>2 ** 62 - 1</code></li>
<li>Usually (almost always) a multiple of 8.</li>
<li>Rarely needs all 64 bits, but is required to have them for the standard.</li>
</ul></li>
<li>Other values - hash values, messages chunks, etc, are 32 bit.</li>
</ul>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>macros.c</strong></pre>
</div>
<div class="sourceCode" id="cb6" data-filename="macros.c"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdint.h&gt;</span><span class="pp"> / * !!! NEW */</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span> <span class="op">{</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint32_t</span> h_i<span class="op">[</span><span class="bn">0x08</span><span class="op">];</span>  <span class="co">/* 256 bit hash */</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint32_t</span> m_i<span class="op">[</span><span class="bn">0x10</span><span class="op">];</span>  <span class="co">/* 512 bit message chunk */</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint64_t</span> l<span class="op">;</span>        <span class="co">/* 64 bit message length */</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* Etc, etc. */</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>We will use these variables to read information from a file.</li>
</ul>
</section>
</div>
</section>
<section id="fileio-show" class="level1">
<h1>FileIO&nbsp;<a class="btn btn-primary" data-bs-toggle="collapse" href="#fileio" role="button" aria-expanded="false" aria-controls="fileio">Show</a></h1>
<div id="fileio" class="collapse multi-collapse">
<p><em>I delivered remarks on file io in a previous term using <a href="https://cd-public.github.io/courses/old/syss24/slides/slides/w05d01.html#/10">these slides</a>.</em></p>
<section id="file-io" class="level2">
<h2 class="anchored" data-anchor-id="file-io">File I/O</h2>
<ul>
<li>We uphold the following exemplar of SHA256: <code>sha256sum</code></li>
</ul>
<div class="sourceCode" id="cb7"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> echo <span class="st">"15 characters."</span> <span class="op">&gt;</span> 15char.txt</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> wc 15char.txt</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a> <span class="ex">1</span>  2 15 15char.txt</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> cat 15char.txt</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="ex">15</span> characters.</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sha256sum 15char.txt</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="ex">5794032f0c0c7ec2c1f43ac9500f65076ad65ec45b8f76e7e2e4cf882b55c3bb</span>  15char.txt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>It computes an SHA-256 hash based on a <em>filename</em>.</li>
<li>We introduce file input (not really output) for equivalence.
<ul>
<li>fopen()</li>
<li>fread()</li>
<li>fprintf()</li>
<li>fclose()</li>
</ul></li>
</ul>
<section id="fopen" class="level3">
<h3 class="anchored" data-anchor-id="fopen">fopen()</h3>
<ul>
<li>C <code>fopen</code> is almost identical to Python <code>open</code>
<ul>
<li>Take a filename, and</li>
<li>A mode, and</li>
<li>Return a “file pointer”
<ul>
<li>In Python, an <code>_io.TextIOWrapper</code></li>
</ul>
<div class="sourceCode" id="cb8"><pre class="sourceCode py code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="bu">open</span>(<span class="st">"lipsum.txt"</span>, <span class="st">"r"</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>_io.TextIOWrapper name<span class="op">=</span><span class="st">'lipsum.txt'</span> mode<span class="op">=</span><span class="st">'r'</span> encoding<span class="op">=</span><span class="st">'cp1252'</span><span class="op">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>In C, a <code>FILE *</code></li>
</ul>
<div class="sourceCode" id="cb9"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="dt">FILE</span> <span class="op">*</span>fopen<span class="op">(</span><span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>pathname<span class="op">,</span> <span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>mode<span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li>We capture the return value in a variable for use with other functions.</li>
</ul></li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>An astute student may note that while the Python script can be run directly, testing a line of C code requires additional supporting lines-of-code (LoC) in a complete <code>.c</code> file with:</p>
<ol type="1">
<li>An <code>#include</code> preprocessor directive to incorporate the <code>stdio</code> library</li>
<li>A <code>main</code> function, likely with a <code>return 0;</code></li>
</ol>
<p>While in this case we are not using this line of code to do anything, versus single lines of Python, single lines of C code are not necessarily independently interpretable or testable.</p>
</div>
</div>
<section id="null-checking" class="level4">
<h4 class="anchored" data-anchor-id="null-checking">Null Checking</h4>
<ul>
<li>In C, and perhaps in Python, it is common to check if a <code>fopen</code> call is successful.
<ul>
<li><code>fopen</code> is something called a “system call” like printf, and should be “null checked”.</li>
<li>We:
<ul>
<li>Capture the return value in a variable, and</li>
<li>Compare the return value to <code>NULL</code> (that is, zero), and</li>
<li>If the return value is <code>NULL</code>, exit with an error code.
<ul>
<li>Usually in C this is <code>exit(1)</code>.</li>
<li>Included in “stdlib.h”</li>
</ul></li>
</ul></li>
</ul></li>
<li>Here is an example:
<ul>
<li>We note that “f_name” is of type <code>char *</code> and includes the file extension.</li>
</ul>
<div class="sourceCode" id="cb10"><pre class="sourceCode C code-with-copy"><code class="sourceCode c"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span><span class="pp"> </span><span class="co">/* exit */</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span> <span class="op">{}</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">char</span> <span class="op">*</span>f_name <span class="op">=</span> <span class="st">"my_file.txt"</span><span class="op">;</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">FILE</span> <span class="op">*</span>fp <span class="op">=</span> fopen<span class="op">(</span>f_name<span class="op">,</span> <span class="st">"r"</span><span class="op">);</span> <span class="co">/* read mode */</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(</span>fp <span class="op">==</span> NULL<span class="op">)</span> <span class="op">{</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>      exit<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li>You are under no real obligation to null check but…
<ul>
<li>Without null checks, very bad times at low probability.</li>
<li>Ground truth for return values is from the <a href="https://man7.org/linux/man-pages/index.html">“man pages”</a></li>
<li>Or use ‘man fopen’ in a non-minimized (not <code>podman</code>) Linux system.</li>
</ul></li>
</ul>
</section>
</section>
<section id="fread" class="level3">
<h3 class="anchored" data-anchor-id="fread">fread()</h3>
<ul>
<li>Once you have opened a file and null checked, it may be read.</li>
<li>As a rule, read files into character arrays.
<ul>
<li>Not quite strings, but not quite not strings.</li>
</ul></li>
<li>For SHA-256, read 512 bits at a time.
<ul>
<li>That is 64 characters/bytes/<code>uint8t_t</code>s</li>
</ul>
<div class="sourceCode" id="cb11"><pre class="sourceCode C code-with-copy"><code class="sourceCode c"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="dt">uint8_t</span> bytes<span class="op">[</span><span class="dv">64</span><span class="op">];</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li>C <code>fread</code> is quite distinct from Python <code>.read()</code>
<ul>
<li>Python <code>.read</code> is object oriented (not C-like)</li>
</ul></li>
<li><code>fread</code> takes four arguments:</li>
</ul>
<div class="sourceCode" id="cb12"><pre class="sourceCode C code-with-copy"><code class="sourceCode c"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="dt">size_t</span> fread<span class="op">(</span><span class="dt">void</span> <span class="op">*</span>ptr<span class="op">,</span> <span class="dt">size_t</span> size<span class="op">,</span> <span class="dt">size_t</span> nmemb<span class="op">,</span> <span class="dt">FILE</span> <span class="op">*</span>stream<span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>A memory location <code>ptr</code> into which to read bytes.
<ul>
<li>Call it the “dst” or “destination”, perhaps.</li>
</ul></li>
<li>A <code>size_t</code> “size”, how big each thing to read is.
<ul>
<li><code>size_t</code> is usually a <code>uint64_t</code>, but doesn’t have to be.</li>
<li>Would be of size <code>1</code> for <code>char</code></li>
<li>Would be of size <code>8</code> for <code>uint64_t</code></li>
<li>Would be of size <code>sizeof(int)</code> for the default <code>int</code> type.</li>
</ul></li>
<li>A <code>size_t</code> ‘nmemb’ for “<span class="math inline">\(n\)</span> members”
<ul>
<li>The number of things of ‘size’ to read.</li>
</ul></li>
<li>A <code>FILE *</code> ‘stream’ from which to read.</li>
<li>fread will read ‘size’ * ‘nmemb’ bytes from ‘stream’ into ‘ptr’.</li>
</ul>
<div class="sourceCode" id="cb13"><pre class="sourceCode C code-with-copy"><code class="sourceCode c"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span><span class="pp"> </span><span class="co">/* exit */</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span> <span class="op">{}</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint8_t</span> bytes<span class="op">[</span><span class="dv">64</span><span class="op">];</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* Unsafe - needs nullchecks */</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">FILE</span> <span class="op">*</span>fp <span class="op">=</span> fopen<span class="op">(</span><span class="st">"my_file.txt"</span><span class="op">,</span> <span class="st">"r"</span><span class="op">);</span> <span class="co">/* read mode */</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    fread<span class="op">(</span>bytes<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">64</span><span class="op">,</span> fp<span class="op">);</span> <span class="co">/* read up to 64 * 8 -&gt; 512 bits */</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="null-checking-1" class="level4">
<h4 class="anchored" data-anchor-id="null-checking-1">~Null checking</h4>
<ul>
<li><code>fread</code> has a variety of interesting return values.
<ul>
<li>It will return the number of members read…</li>
<li>Not necessarily the number of bytes (if ‘size’ is non-one)</li>
</ul></li>
<li>Returns zero on error, but also…</li>
<li>Not all files are as large as the read buffer.
<ul>
<li>In the above example, <code>bytes</code> is the buffer into which we read - the read buffer.</li>
</ul></li>
<li>On SHA-256, you will have to read files of arbitrary size.
<ul>
<li>They will not all be multiples of 512.</li>
<li>You will have to follow the padding algorithm.</li>
<li>Checking the return value of <code>fread</code> will be necessary to determine <em>l</em>.</li>
<li>Make sure you check <code>sizeof(size_t)</code>!</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb14"><pre class="sourceCode C code-with-copy"><code class="sourceCode c"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="dt">size_t</span> l <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> <span class="co">/* SHA-256 length variable 'l' */</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>l <span class="op">+=</span> fread<span class="op">(</span>bytes<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">64</span><span class="op">,</span> fp<span class="op">)</span> <span class="op">&gt;&gt;</span> <span class="dv">3</span><span class="op">;</span> <span class="co">/* 2^3 bits per byte */</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="fprintf" class="level3">
<h3 class="anchored" data-anchor-id="fprintf">fprintf</h3>
<ul>
<li><code>fprintf</code> is like printf, but the leading <code>f</code> allows directing output somewhere other than standard output <code>stdout</code>.</li>
<li>I use it here to direct error messages to a special place, <code>stderr</code>
<ul>
<li><code>stderr</code> is easier to work with in a variety of complicated ways, but…</li>
<li>It is “unbuffered”, so print statements will be output to <code>stderr</code> immediately.</li>
<li>Sometimes, <code>printf</code> statements are lost if errors occur in immediately successive lines of code.</li>
<li>We can also capture <code>stderr</code> output specifically with shell commands:</li>
</ul>
<div class="sourceCode" id="cb15"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ./endian <span class="dv">2</span><span class="op">&gt;</span> /dev/null</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>This <a href="https://unix.stackexchange.com/questions/581240/what-is-the-use-of-script-2-dev-null-in-the-following-script">suppresses all error messages</a>.</li>
</ul></li>
<li>I use <code>fprintf</code> to write error messages within null checks.</li>
<li>Here is one example, from my sha256 reference solution:</li>
</ul>
<div class="sourceCode" id="cb16"><pre class="sourceCode C code-with-copy"><code class="sourceCode c"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="dt">FILE</span> <span class="op">*</span>fp <span class="op">=</span> fopen<span class="op">(</span>f_name<span class="op">,</span> <span class="st">"r"</span><span class="op">);</span> <span class="co">/* read mode */</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>fp <span class="op">==</span> NULL<span class="op">)</span> <span class="op">{</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">"fopen fails on f_name </span><span class="sc">\"%s\"</span><span class="st">, exiting...</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> f_name<span class="op">);</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    exit<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>High reward and no risk.</li>
<li>I will use <code>2&gt; /dev/null</code> in autograders for your convenience.</li>
</ul>
</section>
<section id="fclose" class="level3">
<h3 class="anchored" data-anchor-id="fclose">fclose</h3>
<ul>
<li>I am contractually obligated to tell you to close files.</li>
<li>The interesting bit here is the special <code>EOF</code> character.</li>
<li><a href="https://en.wikipedia.org/wiki/End-of-file">Read more</a>.
<ul>
<li>I refer to <code>EOF</code> a lot in my theory courses, as a “special character” that comes up a lot in automata and computability theory.</li>
</ul></li>
<li>Sample code:</li>
</ul>
<div class="sourceCode" id="cb17"><pre class="sourceCode C code-with-copy"><code class="sourceCode c"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>fclose<span class="op">(</span>fp<span class="op">)</span> <span class="op">==</span> EOF<span class="op">)</span> <span class="op">{</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">"fclose fails on f_name </span><span class="sc">\"%s\"</span><span class="st">, exiting...</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> f_name<span class="op">);</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    exit<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
</div>
</section>
<section id="option-show" class="level1">
<h1>Option&nbsp;<a class="btn btn-primary" data-bs-toggle="collapse" href="#option" role="button" aria-expanded="false" aria-controls="option">Show</a></h1>
<div id="option" class="collapse multi-collapse">
<section id="optional-exercise" class="level2">
<h2 class="anchored" data-anchor-id="optional-exercise">Optional Exercise</h2>
<ul>
<li>Write a C language executable that
<ul>
<li>Given a file name at command line…</li>
<li>Prints out the contents of the file…</li>
<li>In hexadecimal…</li>
<li>In chunks of size 512 bytes.</li>
</ul></li>
<li>Sample input:</li>
</ul>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>lipsum.txt</strong></pre>
</div>
<div class="sourceCode" id="cb18" data-filename="lipsum.txt"><pre class="sourceCode html code-overflow-wrap code-with-copy"><code class="sourceCode html"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Sample command:</li>
</ul>
<div class="sourceCode" id="cb19"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./fileio</span> lipsum.txt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>Sample output:</li>
</ul>
<div class="sourceCode" id="cb20" style="max-height:6em;overflow-y: scroll;"><pre class="sourceCode email code-with-copy"><code class="sourceCode email"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>4c6f7265 6d206970 73756d20 646f6c6f </span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>72207369 7420616d 65742c20 636f6e73 </span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>65637465 74757220 61646970 69736369 </span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>6e672065 6c69742c 20736564 20646f20</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>65697573 6d6f6420 74656d70 6f722069 </span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>6e636964 6964756e 74207574 206c6162 </span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>6f726520 65742064 6f6c6f72 65206d61 </span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>676e6120 616c6971 75612e20 55742065</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>6e696d20 6164206d 696e696d 2076656e </span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>69616d2c 20717569 73206e6f 73747275 </span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>64206578 65726369 74617469 6f6e2075 </span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>6c6c616d 636f206c 61626f72 6973206e</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>69736920 75742061 6c697175 69702065 </span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>78206561 20636f6d 6d6f646f 20636f6e </span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>73657175 61742e20 44756973 20617574 </span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>65206972 75726520 646f6c6f 7220696e</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>20726570 72656865 6e646572 69742069 </span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>6e20766f 6c757074 61746520 76656c69 </span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>74206573 73652063 696c6c75 6d20646f </span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>6c6f7265 20657520 66756769 6174206e</span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>756c6c61 20706172 69617475 722e2045 </span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>78636570 74657572 2073696e 74206f63 </span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>63616563 61742063 75706964 61746174 </span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>206e6f6e 2070726f 6964656e 742c2073</span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>756e7420 696e2063 756c7061 20717569 </span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>206f6666 69636961 20646573 6572756e </span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>74206d6f 6c6c6974 20616e69 6d206964 </span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a>20657374 206c6162 6f72756d 2e0a</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>It is a simply matter to verify correctness.
<ul>
<li>Take the first hexadecimal character - <code>0x4c</code>.</li>
<li>Use e.g.&nbsp;Python <code>chr</code>.</li>
<li>Get the letter <code>L</code>.</li>
</ul>
<div class="sourceCode" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="bu">chr</span>(<span class="bn">0x4c</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><strong><em>Spoilers</em></strong> Solution:</li>
</ul>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>fileio.c</strong></pre>
</div>
<div class="sourceCode" id="cb22" data-filename="fileio.c" style="max-height:8em;overflow-y: scroll;"><pre class="sourceCode C code-with-copy"><code class="sourceCode c"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* </span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co"> * fileio.c </span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co"> *</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co"> * Write a C language executable that given a file name </span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="co"> * prints out the contents of the file in hexadecimal </span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="co"> * in chunks of size 512 bytes.</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="co">/*</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="co">gcc fileio.c --std=c89 -Wall -Wextra -Werror -Wpedantic -O2 -o fileio</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdint.h&gt;</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span> <span class="op">*</span>argv<span class="op">[])</span> <span class="op">{</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>    <span class="dt">size_t</span> i<span class="op">,</span> l <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint8_t</span> m<span class="op">[</span><span class="dv">64</span><span class="op">];</span></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>    <span class="dt">FILE</span> <span class="op">*</span>fp<span class="op">;</span> </span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!(</span>argc <span class="op">&gt;</span> <span class="dv">1</span><span class="op">))</span> <span class="op">{</span></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>        fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">"No filename argument provided, exiting...</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>        exit<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>    fp <span class="op">=</span> fopen<span class="op">(</span>argv<span class="op">[</span><span class="dv">1</span><span class="op">],</span> <span class="st">"r"</span><span class="op">);</span> <span class="co">/* read mode */</span></span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>fp <span class="op">==</span> NULL<span class="op">)</span> <span class="op">{</span></span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>        fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">"fopen fails on argv[1] </span><span class="sc">\"%s\"</span><span class="st">, exiting...</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> argv<span class="op">[</span><span class="dv">1</span><span class="op">]);</span></span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>        exit<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">do</span> <span class="op">{</span></span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a>        l <span class="op">=</span> fread<span class="op">(</span>m<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">64</span><span class="op">,</span> fp<span class="op">);</span></span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span>i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> l<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>i <span class="op">%</span> <span class="dv">4</span> <span class="op">==</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> i <span class="op">&gt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a>                printf<span class="op">(</span><span class="st">" "</span><span class="op">);</span></span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>i <span class="op">%</span> <span class="dv">16</span> <span class="op">==</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> i <span class="op">&gt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb22-42"><a href="#cb22-42" aria-hidden="true" tabindex="-1"></a>                printf<span class="op">(</span><span class="st">"</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb22-43"><a href="#cb22-43" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb22-44"><a href="#cb22-44" aria-hidden="true" tabindex="-1"></a>            printf<span class="op">(</span><span class="st">"</span><span class="sc">%02x</span><span class="st">"</span><span class="op">,</span> m<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb22-45"><a href="#cb22-45" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb22-46"><a href="#cb22-46" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">\n\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb22-47"><a href="#cb22-47" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">while</span> <span class="op">(</span>l <span class="op">==</span> <span class="dv">64</span><span class="op">);</span></span>
<span id="cb22-48"><a href="#cb22-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-49"><a href="#cb22-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>fclose<span class="op">(</span>fp<span class="op">)</span> <span class="op">==</span> EOF<span class="op">)</span> <span class="op">{</span></span>
<span id="cb22-50"><a href="#cb22-50" aria-hidden="true" tabindex="-1"></a>        fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">"fclose fails on argv[1] </span><span class="sc">\"%s\"</span><span class="st">, exiting...</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> argv<span class="op">[</span><span class="dv">1</span><span class="op">]);</span></span>
<span id="cb22-51"><a href="#cb22-51" aria-hidden="true" tabindex="-1"></a>        exit<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb22-52"><a href="#cb22-52" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb22-53"><a href="#cb22-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-54"><a href="#cb22-54" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb22-55"><a href="#cb22-55" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>An astute student may note that the “do… while” formulation is unusual.</p>
<ol type="1">
<li>In this, we will always print <em>something</em>.</li>
<li>The empty file (a file of size zero) and no file (the absence of a file of a given name) are distinct.</li>
<li>Therefore, we always read from the file at least once after null-checking.</li>
<li>However, we only read <em>again</em> if at least 512 bytes were read…</li>
<li>Otherwise we read all the content of the file.</li>
</ol>
<p>The “do… while” formulation is uncommon, but makes this specific use case much easier. Where else might you use a “do… while”? Why?</p>
</div>
</div>
</section>
</div>
</section>
<section id="astyle-show" class="level1">
<h1>astyle&nbsp;<a class="btn btn-primary" data-bs-toggle="collapse" href="#astyle" role="button" aria-expanded="false" aria-controls="astyle">Show</a></h1>
<div id="astyle" class="collapse multi-collapse">
<section id="optional-utility" class="level2">
<h2 class="anchored" data-anchor-id="optional-utility">Optional Utility</h2>
<ul>
<li>You may find keeping your C code formatted in <code>vim</code> frustrating.</li>
<li>Simply exit <code>vim</code> and invoke <code>astyle</code>.</li>
</ul>
<div class="sourceCode" id="cb23"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="ex">astyle</span> fileio.c</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>It is likely not on your system by default.
<ul>
<li>Add to the Containerfile and rebuild, or</li>
</ul>
<div class="sourceCode" id="cb24"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="ex">apt</span> install astyle <span class="co"># this assumes ubuntu, not alpine</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li>There are <a href="https://clang.llvm.org/extra/clang-tidy/">other such utilities</a>, but this one is quick and nice.</li>
<li>If you are using a build script, you can simply add <code>astyle</code>.</li>
</ul>
</section>
</div>
</section>
<section id="endian-show" class="level1">
<h1>Endian&nbsp;<a class="btn btn-primary" data-bs-toggle="collapse" href="#endian" role="button" aria-expanded="false" aria-controls="endian">Show</a></h1>
<div id="endian" class="collapse multi-collapse">
<p><em>Endianness is a challenge topic. Be systematic, patient, and indefatigable.</em></p>
<section id="endianness" class="level2">
<h2 class="anchored" data-anchor-id="endianness">Endianness</h2>
<ul>
<li>For an out-of-scope reason, most computers store bits differently than most networks.</li>
<li>SHA-256 analyzes bits on a computer that are slated to go out on a network.</li>
<li>This topic is called “Endianness”</li>
<li>We go live to a lightly-formatted <a href="https://chatgpt.com/share/67760b2c-bc3c-8003-aa86-92183c898650">LLM generated .md write-up</a>:</li>
</ul>
<section id="llms-on-endianess" class="level3">
<h3 class="anchored" data-anchor-id="llms-on-endianess">LLMs on Endianess</h3>
<ul>
<li>Endianness refers to the byte order used to store multi-byte data types.</li>
<li>Like <code>int</code>, <code>unigned</code>, and <code>size_t</code> in memory.</li>
<li>There are two main types:
<ol type="1">
<li>Little-Endian</li>
</ol>
<ul>
<li><strong>Definition</strong>: The least significant byte (LSB) is stored at the lowest memory address.</li>
<li><strong>Example</strong>: The number <code>0x1234ABCD</code> is stored in memory as:</li>
</ul>
<div class="sourceCode" id="cb25"><pre class="sourceCode email code-with-copy"><code class="sourceCode email"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>1234ABCD</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><em>Editors Note:</em> This is very hard to check, I might add.</li>
</ul>
<ol start="2" type="1">
<li>Big-Endian</li>
</ol>
<ul>
<li><strong>Definition</strong>: The most significant byte (MSB) is stored at the lowest memory address.</li>
<li><strong>Example</strong>: The number <code>0x1234ABCD</code> is stored in memory as:</li>
</ul>
<div class="sourceCode" id="cb26"><pre class="sourceCode email code-with-copy"><code class="sourceCode email"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>CDAB3412</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>An astute student may note that <code>CDAB3412</code> does not appear to be the reversal of <code>1234ABCD</code></p>
<ol type="1">
<li>Endianness reverses specifically <em>bytes</em>, 8 bits of information.</li>
<li>Hexadecimal notation expresses specifically <em>nibs</em> or <em>half-bytes</em>, 4 bits of information.</li>
<li><code>D</code> is a nib and <code>CD</code> is a byte.</li>
<li>‘1234’ in reverse byte order is <code>3412</code> and is <strong>!!!NOT!!!</strong> <code>4321</code></li>
<li><code>4321</code> would constitute a <em>nib</em> or <em>half-byte</em> reversal.</li>
</ol>
<p>I recommend thinking of every <em>pair</em> of hexadecimal characters as digit in base 0x100 or base 256 expression of some numerical value.</p>
</div>
</div>
<ul>
<li>Why Endianness Matters
<ul>
<li><strong>Data Interoperability</strong>: Different systems may use different endianness, causing issues when sharing binary data.</li>
<li><strong>Networking</strong>: The Internet Protocol (IP) uses big-endian (network byte order).</li>
<li><em>Editors Note:</em> SHA-256 in practice uses big-endian.</li>
</ul></li>
<li>Detecting Endianness in C
<ul>
<li>You can determine the endianness of your system using the following code:</li>
</ul></li>
</ul>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>checke.c</strong></pre>
</div>
<div class="sourceCode" id="cb27" data-filename="checke.c"><pre class="sourceCode C code-with-copy"><code class="sourceCode c"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span> <span class="op">{</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">unsigned</span> <span class="dt">int</span> x <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">char</span> <span class="op">*</span>c <span class="op">=</span> <span class="op">(</span><span class="dt">char</span> <span class="op">*)&amp;</span>x<span class="op">;</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(*</span>c<span class="op">)</span> <span class="op">{</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>      printf<span class="op">(</span><span class="st">"Little-Endian</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>      printf<span class="op">(</span><span class="st">"Big-Endian</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="why-it-matters" class="level3">
<h3 class="anchored" data-anchor-id="why-it-matters">Why it matters</h3>
<ul>
<li>To my knowledge, all reference SHA-256 solutions use big endian.</li>
<li>My physical device uses little endian, and I suspect yours does too.</li>
</ul>
</section>
<section id="arpainet.h" class="level3">
<h3 class="anchored" data-anchor-id="arpainet.h">arpa/inet.h</h3>
<ul>
<li>This was a big problem in the early internet days.</li>
<li>ARPA, now DARPA, more or less launched the modern internet.</li>
<li>They are responsible for the C89 eligible header <code>arpa/inet.h</code>
<ul>
<li>It contains e.g.&nbsp;<code>htonl</code>
<ul>
<li>“Host to network long”</li>
<li>In 1989, <code>uint32_t</code> was commonly called a (unsigned) long.</li>
<li>Endianness and signedness are non-interactive.
<ul>
<li>Recall the <a href="../encode.html">Encode</a> lecture on signedness.</li>
</ul></li>
</ul></li>
<li>In 2024, often use <code>htobe32</code>
<ul>
<li>“Host to big endian 32bit”</li>
<li>From C99 <code>endian.h</code></li>
<li>As with <code>%b</code>, you may use to debug but not to solve your homework.
<ul>
<li>That said, it is better to turn in a solution using <code>endian.h</code> than no solution.</li>
<li>This is an exception to the typical “no partial credit” policy.</li>
</ul></li>
</ul></li>
</ul></li>
</ul>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>endian.c</strong></pre>
</div>
<div class="sourceCode" id="cb28" data-filename="endian.c"><pre class="sourceCode C code-with-copy"><code class="sourceCode c"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* endian.c - &amp;exists; C99+ &lt;endian.h&gt; be advised */</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co">/*</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="co">gcc endian.c -O2 -o endian</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span><span class="pp">  </span><span class="co">/* fileio   */</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdint.h&gt;</span><span class="pp"> </span><span class="co">/* uint32_t */</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="co">/* Optionally - endianness compatability.  */</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;arpa/inet.h&gt;</span><span class="pp"> </span><span class="co">/* htonl */</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;endian.h&gt;</span><span class="pp"> </span><span class="co">/* htobe32 */</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a><span class="dt">uint32_t</span> my_htonl<span class="op">(</span><span class="dt">uint32_t</span> n<span class="op">)</span> <span class="op">{</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> n<span class="op">;</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span> <span class="op">{</span></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint32_t</span> test <span class="op">=</span> <span class="bn">0x1234ABCD</span><span class="op">;</span></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%08X\n%08X\n%08X\n</span><span class="st">"</span><span class="op">,</span></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>           test<span class="op">,</span></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>           htonl<span class="op">(</span>test<span class="op">),</span></span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>           htobe32<span class="op">(</span>test<span class="op">),</span></span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>           my_htonl<span class="op">(</span>test<span class="op">)</span></span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>          <span class="op">);</span></span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>We will now step through an example solution to <code>my_htonl</code>.</li>
<li>We will leave as an exercise <code>htonll</code> - the 64 bit variant.</li>
<li>You can compare against the <code>htobe64</code> from <code>endian.h</code>
<ul>
<li>Not using <code>htobe64</code> is not just a learning goal.</li>
<li>Removing <code>endian.h</code> from my code sped it up 5x in testing.</li>
</ul></li>
<li>I note I will assume the “host” is litte endian.
<ul>
<li>It is trivial to check, and you may do so, or use a <code>#define</code></li>
</ul></li>
</ul>
</section>
<section id="memory" class="level3">
<h3 class="anchored" data-anchor-id="memory">Memory</h3>
<ul>
<li>The core insight of endianness is that it refers to bits in memory.</li>
<li>Recall we have used the notion of memory a few times:
<ul>
<li>Strings in C are characters in adjacent memory locations.</li>
<li>Bitwise operations act on bits in adjacent memory locations.</li>
<li>The star <code>*</code> operator and array notation <code>[n]</code> are similar.</li>
</ul></li>
<li>We will rearrange bits using a novel operator - <code>&amp;</code>, which negates <code>*</code>.
<ul>
<li>We note that unary prefix <code>&amp;</code> is a memory operator, distinct from</li>
<li>Binary infix <code>&amp;</code> which is a bitwise operator.</li>
</ul></li>
</ul>
</section>
<section id="initial-state" class="level3">
<h3 class="anchored" data-anchor-id="initial-state">Initial State</h3>
<ul>
<li>We begin with the indentity operation on <code>uint32_t</code>.</li>
</ul>
<div class="sourceCode" id="cb29"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="dt">uint32_t</span> my_htonl<span class="op">(</span><span class="dt">uint32_t</span> n<span class="op">)</span> <span class="op">{</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> n<span class="op">;</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="variables" class="level3">
<h3 class="anchored" data-anchor-id="variables">Variables</h3>
<ul>
<li>In C89 style, we first declare variables.</li>
<li>First is an alias for <code>n</code>.
<ul>
<li>We will treat the 32 bit int as an array of 8 bit ints.</li>
<li>An 8 bit int is of type <code>uint8_t</code></li>
<li>An array is of type <code>*</code></li>
</ul></li>
<li>We initialize it to no value, for now.</li>
</ul>
<div class="sourceCode" id="cb30"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="dt">uint32_t</span> my_htonl<span class="op">(</span><span class="dt">uint32_t</span> n<span class="op">)</span> <span class="op">{</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint8_t</span> <span class="op">*</span>alias<span class="op">;</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> n<span class="op">;</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>We will also be swapping bits around.</li>
<li>In Python we can use <em>multiple assignment</em></li>
</ul>
<div class="sourceCode" id="cb31"><pre class="sourceCode py code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>x, y <span class="op">=</span> y, x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>This only works with key-value pairs, not arrays.</li>
<li>We use a swapping variable, a la</li>
</ul>
<div class="sourceCode" id="cb32"><pre class="sourceCode py code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>t : <span class="bu">int</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> x</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> y</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> t</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="kw">del</span> t</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>In C:</li>
</ul>
<div class="sourceCode" id="cb33"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="dt">uint32_t</span> my_htonl<span class="op">(</span><span class="dt">uint32_t</span> n<span class="op">)</span> <span class="op">{</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint8_t</span> swap<span class="op">,</span> <span class="op">*</span>alias<span class="op">;</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> n<span class="op">;</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>We will be looping over something that is quite like an array, so we need an index variable.
<ul>
<li>I create this variable of type <code>size_t</code> because:
<ul>
<li>We will compare it to a <code>sizeof</code></li>
<li>We will use it as an array index to denote memory locations.</li>
<li>So the C implementation will guarantee <code>size_t</code> is appropriate for array indices.</li>
<li>You can determine what a <code>size_t</code> is using the usual methods for examining C code.</li>
</ul></li>
</ul></li>
</ul>
<div class="sourceCode" id="cb34"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="dt">uint32_t</span> my_htonl<span class="op">(</span><span class="dt">uint32_t</span> n<span class="op">)</span> <span class="op">{</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint8_t</span> swap<span class="op">,</span> <span class="op">*</span>alias<span class="op">;</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">size_t</span> index<span class="op">;</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> n<span class="op">;</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="ampersand" class="level3">
<h3 class="anchored" data-anchor-id="ampersand">Ampersand</h3>
<ul>
<li>We will now use the ampersand <code>&amp;</code> operator.
<ul>
<li>We want the <code>uint8_t *</code> array alias to refer to the same bits and the <code>uint32_t</code> numerical value <code>n</code>.</li>
<li>The location of the bits that constitute <code>n</code> in memory is given by <code>&amp;n</code>.</li>
<li>So we set the alias equal to that location.</li>
</ul>
<div class="sourceCode" id="cb35"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="dt">uint32_t</span> my_htonl<span class="op">(</span><span class="dt">uint32_t</span> n<span class="op">)</span> <span class="op">{</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">uint8_t</span> swap<span class="op">,</span> <span class="op">*</span>alias <span class="op">=</span> <span class="op">&amp;</span>n<span class="op">;</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">size_t</span> index<span class="op">;</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> n<span class="op">;</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li>If you are confused at all, you should stop and print out, minimally:
<ul>
<li>The values of the star, amperand, and unmodified alias and n variables.</li>
<li>Anything else you think of.</li>
<li>You should do these all in different lines in case you get an error.</li>
<li>You should think of the <code>&amp;n</code> as the key of <code>n</code> in the key-value memory storage of the system.</li>
</ul></li>
</ul>
</section>
<section id="casting" class="level3">
<h3 class="anchored" data-anchor-id="casting">Casting</h3>
<ul>
<li>When I run this code, I get this warning:</li>
</ul>
<div class="sourceCode" id="cb36"><pre class="sourceCode email code-with-copy"><code class="sourceCode email"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>endian.c: In function ‘my_htonl’:</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>endian.c:15:26: warning: initialization of ‘uint8_t *’ {aka ‘unsigned char *’} from incompatible pointer type ‘uint32_t *’ {aka ‘unsigned int *’} [-Wincompatible-pointer-types]</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>   15 |     uint8_t swap, *arr = &amp;n;</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>      |        </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>That’s a good warning, I am doing something extremely sketchy.
<ul>
<li>After all, I told <code>gcc</code> that <code>n</code> was a 32 bit integer.</li>
<li>Then I told it that the the location <code>n</code> was in held an array of 8 bit integers.</li>
<li>Those things can’t both be true.</li>
</ul></li>
<li>We assure <code>gcc</code> that we know what we are doing with a <em>cast</em>
<ul>
<li>We apply a <em>cast</em> to a value, like the value of the memory location of <code>n</code></li>
<li>A cast is a type name in parenthesis as a prefix.</li>
<li>A cast assures the compiler of the intentionality of this mapping of bits to variable names.</li>
<li>We are claiming we want to regard <code>n</code> as an array of 8 bit integers, as a <code>uint8_t *</code>.</li>
</ul></li>
<li>So:</li>
</ul>
<div class="sourceCode" id="cb37"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="dt">uint32_t</span> my_htonl<span class="op">(</span><span class="dt">uint32_t</span> n<span class="op">)</span> <span class="op">{</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint8_t</span> swap<span class="op">,</span> <span class="op">*</span>alias <span class="op">=</span> <span class="op">(</span><span class="dt">uint8_t</span> <span class="op">*)&amp;</span>n<span class="op">;</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">size_t</span> index<span class="op">;</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> n<span class="op">;</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>This silenced all my <code>gcc</code> warnings and errors.</li>
</ul>
</section>
<section id="main-loop" class="level3">
<h3 class="anchored" data-anchor-id="main-loop">Main loop</h3>
<ul>
<li>It now suffices to rearrange the bits within 32 bit integer <code>n</code></li>
<li>Helpfully, we can refer to these bits using the aliasing 8 bit integer array <code>alias</code>.</li>
</ul>
<div class="sourceCode" id="cb38"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="dt">uint32_t</span> my_htonl<span class="op">(</span><span class="dt">uint32_t</span> n<span class="op">)</span> <span class="op">{</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint8_t</span> swap<span class="op">,</span> <span class="op">*</span>alias <span class="op">=</span> <span class="op">(</span><span class="dt">uint8_t</span> <span class="op">*)&amp;</span>n<span class="op">;</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">size_t</span> index<span class="op">;</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    swap <span class="op">=</span> alias<span class="op">[</span><span class="dv">0</span><span class="op">];</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>    alias<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> alias<span class="op">[</span><span class="dv">3</span><span class="op">];</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>    alias<span class="op">[</span><span class="dv">3</span><span class="op">]</span> <span class="op">=</span> swap<span class="op">;</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>    swap <span class="op">=</span> alias<span class="op">[</span><span class="dv">1</span><span class="op">];</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>    alias<span class="op">[</span><span class="dv">1</span><span class="op">]</span> <span class="op">=</span> alias<span class="op">[</span><span class="dv">2</span><span class="op">];</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>    alias<span class="op">[</span><span class="dv">2</span><span class="op">]</span> <span class="op">=</span> swap<span class="op">;</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> n<span class="op">;</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>You will note this contains repeated code, and is therefore <em>de facto</em> wrong, though it runs correctly.</li>
</ul>
</section>
</section>
</div>
</section>
<section id="htonll-show" class="level1">
<h1>htonll&nbsp;<a class="btn btn-primary" data-bs-toggle="collapse" href="#htonll" role="button" aria-expanded="false" aria-controls="htonll">Show</a></h1>
<section id="htonll" class="level2 collapse multi-collapse">
<h2 class="anchored" data-anchor-id="htonll">htonll</h2>
<ul>
<li>Write a 64 bit endianness inverter.</li>
<li>You should start with your <code>my_htonl</code> code if you are stuck.
<ul>
<li>Refactor the internals into a loop</li>
<li>Use <code>sizeof</code> for the loop termination.</li>
</ul></li>
<li>Advanced students may wish to write a size agnostic <code>HTON</code> macro.
<ul>
<li>This is non-trivial but probably possible (I didn’t check).</li>
</ul></li>
</ul>
</section>
</section>
<section id="memset-show" class="level1">
<h1>memset&nbsp;<a class="btn btn-primary" data-bs-toggle="collapse" href="#memset" role="button" aria-expanded="false" aria-controls="memset">Show</a></h1>
<div id="memset" class="collapse multi-collapse">
<section id="memset" class="level2">
<h2 class="anchored" data-anchor-id="memset">memset</h2>
<ul>
<li>The C89 “string.h” library contains a helpful function <code>memset</code>.</li>
</ul>
<div class="sourceCode" id="cb39"><pre class="sourceCode email code-with-copy"><code class="sourceCode email"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>NAME</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>       memset - fill memory with a constant byte</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>SYNOPSIS</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>       #include &lt;string.h&gt;</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>       void *memset(void *s, int c, size_t n);</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>DESCRIPTION</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>       The memset() function fills the first n bytes of the</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>       memory area pointed to by s with the  constant  byte</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>       c.</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>RETURN VALUE</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>       The  memset() function returns a pointer to the mem‐</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>       ory area s.</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>I use <code>memset</code> to zero out all my arrays before I use them.</li>
<li>This usually doesn’t matter but is very nice with string data.</li>
</ul>
</section>
<section id="memcpy" class="level2">
<h2 class="anchored" data-anchor-id="memcpy">memcpy</h2>
<ul>
<li>The C89 “string.h” library contains a helpful function <code>memcpy</code>.
<ul>
<li>I have never once in my life remembered destination is first, not source.</li>
<li>I spent an hour trying to figure out a bug caused by that.</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb40"><pre class="sourceCode email code-with-copy"><code class="sourceCode email"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>NAME</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>       memcpy - copy memory area</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>SYNOPSIS</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>       #include &lt;string.h&gt;</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>       void *memcpy(void *dest, const void *src, size_t n);</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>DESCRIPTION</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>       The memcpy() function copies n bytes from memory area src to memory area dest.  The memory</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>       areas must not overlap.  Use memmove(3) if the memory areas do overlap.</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>RETURN VALUE</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>       The memcpy() function returns a pointer to dest.</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>ATTRIBUTES</span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>       For an explanation of the terms used in this section, see attributes(7).</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>I use <code>memcpy</code> to move data into and out of SHA internal state:
<ul>
<li>The working variables.</li>
<li>The current <span class="math inline">\(H_i\)</span> hash value.</li>
<li>The current <span class="math inline">\(M_i\)</span> message data.</li>
</ul></li>
</ul>
</section>
</div>
</section>
<section id="arrays-show" class="level1">
<h1>Arrays&nbsp;<a class="btn btn-primary" data-bs-toggle="collapse" href="#arrays" role="button" aria-expanded="false" aria-controls="arrays">Show</a></h1>
<div id="arrays" class="collapse multi-collapse">
<section id="arrays" class="level2">
<h2 class="anchored" data-anchor-id="arrays">Arrays</h2>
<ul>
<li>You will be tempted to write functions of this form:</li>
</ul>
<div class="sourceCode" id="cb41"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* Take two arrays and a return a new array */</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> <span class="op">*</span>new_hash<span class="op">(</span><span class="dt">uint32_t</span> <span class="op">*</span>m_i<span class="op">,</span> <span class="dt">uint32_t</span> <span class="op">*</span>h_i<span class="op">)</span> <span class="op">{</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint32_t</span> h_i_1<span class="op">[</span><span class="dv">8</span><span class="op">];</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* some operations */</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> h_i_1<span class="op">;</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>This will cause a segmentation fault for the following reason.
<ul>
<li><code>h_i_1</code> refers to a memory location.</li>
<li>That memory location is a local variable of the <code>new_hash</code> function</li>
<li>When <code>new_hash</code> returns, it no longer manages it’s local variables.</li>
<li>Therefore, it is no longer safe to access that memory location.
<ul>
<li>It is, essentially, reclaimed by the operating system.</li>
<li>This occurs probabilitistically, but at high probability.</li>
</ul></li>
<li>So the next effort to access a value in <code>h_i_1</code> will trigger the OS to terminate your program.</li>
</ul></li>
<li>Here is the C alternative:</li>
</ul>
<div class="sourceCode" id="cb42"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* Take two arrays as arguments and update the second */</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> new_hash<span class="op">(</span><span class="dt">uint32_t</span> <span class="op">*</span>m_i<span class="op">,</span> <span class="dt">uint32_t</span> <span class="op">*</span>h_i<span class="op">)</span> <span class="op">{</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint32_t</span> h_i_1<span class="op">[</span><span class="dv">8</span><span class="op">];</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* some operations */</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>    memcpy<span class="op">(</span>h_i<span class="op">,</span> h_i_1<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>h_i_1<span class="op">));</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span><span class="op">;</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><code>h_i</code> is safe because it is managed by some other function.
<ul>
<li>Likely <code>main</code> or some other function that called <code>new_hash</code>.</li>
</ul></li>
<li>Therefore, it will not be reclaimed by the OS on return from <code>new_hash</code>.</li>
</ul>
</section>
<section id="take-aways" class="level2">
<h2 class="anchored" data-anchor-id="take-aways">Take-aways</h2>
<ul>
<li>Don’t return arrays.</li>
<li>Provide arrays as arguments and update the provided arrays.</li>
<li>There are other ways to do this that we will learn in time.
<ul>
<li>But they are unhelpful on SHA-256, and would enable low quality solutions.</li>
</ul></li>
</ul>
</section>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>